---
name: feature-release
workflow_step: 5-release
description: >
  Финализация документации, тестов и чеклистов перед релизом фичи.
variables:
  feature:
    prompt: "Slug активной фичи."
  release_notes_path:
    prompt: >-
      Путь к файлу с релизными заметками.
    default: "docs/release-notes.md"
context:
  files:
    - workflow.md
    - docs/prd/{{feature}}.prd.md
    - docs/design/{{feature}}.md
    - docs/plan/{{feature}}.md
    - docs/tasklist/{{feature}}.md
    - docs/research/{{feature}}.md
    - reports/research/{{feature}}-context.json
    - reports/qa/{{feature}}.json
  instructions:
    - >-
      Собери текущее состояние из PRD/plan/tasklist/research и отчётов
      `reports/research/*.json`, `reports/qa/{{feature}}.json`. Укажи, какие
      гейты запущены и какие команды нужно выполнить перед релизом.
    - >-
      В релизных заметках перечисли изменения, команды выката/отката и ссылки
      на tasklist/PRD, чтобы обновлённый agent-first процесс был
      воспроизводим.
    - "{{release_notes_path}}"
    - >-
      Проверь, что все чекбоксы по фиче {{feature}} закрыты.
    - >-
      Собери ключевые метрики, результаты тестирования и TODO для
      следующего цикла.
    - >-
      Обнови релизные заметки и выпиши обратную связь.
    - >-
      Убедись, что рекомендации Researcher закрыты: статус `Status: reviewed`,
      action items перенесены в план/тасклист или описаны в релизнных заметках.
output:
  path: "{{release_notes_path}}"
  format: markdown
  mode: append
  anchor: "## {{feature}}"
claude:
  mode: interact
  temperature: 0.15
  guardrails:
    - "Не отметь задачу выполненной, если отсутствуют подтверждения тестов."
    - "Согласуй формулировки релизных заметок с продуктовым владельцем."
