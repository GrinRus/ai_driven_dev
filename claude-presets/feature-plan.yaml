---
name: feature-plan
workflow_step: 3-plan
description: >
  Детализированный план реализации на основе PRD и дизайна.
variables:
  feature:
    prompt: "Slug активной фичи."
  design_path:
    prompt: >-
      Путь к дизайн-документу, если отличается от стандартного
      docs/design/{{feature}}.md.
    default: "docs/design/{{feature}}.md"
context:
  files:
    - workflow.md
    - "{{design_path}}"
    - docs/prd/{{feature}}.prd.md
    - docs/research/{{feature}}.md
    - docs/tasklist.template.md
    - reports/research/{{feature}}-context.json
    - reports/research/{{feature}}-targets.json
  instructions:
    - >-
      Используй repo-first данные: прочитай PRD, research, backlog и отчёты
      `reports/research/{{feature}}-(context|targets).json`, перечисли затронутые
      модули и существующие точки интеграции.
    - >-
      Сформируй план итерациями, ссылаясь на файлы/команды (например,
      `.claude/hooks/format-and-test.sh`, `./gradlew :service:test`). План
      должен указывать, какие шаги уже покрыты шаблонами и что нужно открыть
      в tasklist.
    - docs/customization.md
    - >-
      Составь пошаговый план реализации фичи {{feature}}.
    - >-
      Определи зависимости, риски и контрольные точки.
    - >-
      Свяжи план с будущими задачами тасклиста и гейтами (API, DB, тесты).
    - >-
      Учти выводы Researcher: куда встраиваем изменения, что переиспользуем,
      какие долги и риски нужно закрыть.
output:
  path: docs/plan/{{feature}}.md
  format: markdown
  mode: overwrite
claude:
  mode: interact
  temperature: 0.2
  guardrails:
    - "Сверь план с существующими ограничениями дизайна и PRD."
    - "Добавь вопросы к продукту, если информации недостаточно."
