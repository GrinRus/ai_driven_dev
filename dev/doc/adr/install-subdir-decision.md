# ADR: Workspace в поддиректории `aidd/`

## Контекст
- Плагин поставляется через marketplace и живёт в корне репозитория (`commands/`, `agents/`, `hooks/`).
- Нужно изолировать рабочие артефакты (`docs/`, `reports/`, `config/`) от корня продукта.
- Init должен быть идемпотентным и не перезаписывать пользовательские изменения.
- Smoke/pytest должны использовать текущий git checkout без внешних архивов.

## Варианты
1) **Поверх корня**: раскладывать `.claude`, `docs`, `config` прямо в `<repo>/`.
   - Плюсы: меньше вложенность, привычные пути.
   - Минусы: коллизии с проектными файлами, сложнее поддерживать шаблоны.
2) **Поддиректория `aidd/` (выбран)**: держать рабочие артефакты внутри `<workspace>/aidd/`.
   - Плюсы: изоляция артефактов, простое обновление/удаление, можно иметь несколько инстансов.
   - Минусы: дополнительный уровень пути, нужно явно учитывать `aidd/` в хуках и доках.
3) **Шаблонный репозиторий/подмодуль**: подключение workspace как git-submodule.
   - Плюсы: явное версионирование.
   - Минусы: сложность для пользователей, лишняя git-зависимость, конфликт с идемпотентным init.

## Решение
- Принять вариант 2: workspace разворачивается в `aidd/` относительно корня проекта.
- `/aidd-init` создаёт структуру из `templates/aidd` и не перезаписывает существующие файлы.
- Smoke/e2e запускаются из текущей ветки в tmp-каталоге: `dev/repo_tools/smoke-workflow.sh` не тянет внешние архивы.
- Плагин устанавливается через marketplace; CLI-пэйлоада нет.

## Последствия
- Документация и примеры должны ссылаться на пути `aidd/...` для артефактов.
- Канонические шаблоны живут в `templates/aidd/`.
- Хуки проверяют пути промптов внутри `agents/` и `commands/`, а артефактов — внутри `aidd/`.
- Запуск хуков вне workspace должен явно падать с подсказкой `/aidd-init`.

## To-do
- Обновить гайды (`dev/doc/workflow.md`, README*).
- Описать миграцию для существующих установок (перенос из корня в `aidd/`).
- Зафиксировать примеры запуска smoke/pytest после миграции.
