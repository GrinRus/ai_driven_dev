#!/usr/bin/env bash
set -euo pipefail

ROOT_DIR="$(git rev-parse --show-toplevel)"
HOOK="${ROOT_DIR}/hooks/format-and-test.sh"

# Установите PRE_PUSH_SKIP=1, чтобы временно отключить проверку.
if [[ "${PRE_PUSH_SKIP:-0}" == "1" ]]; then
  exit 0
fi

if [[ ! -x "$HOOK" ]]; then
  printf '[pre-push] %s не найден, пропускаем проверки\n' "$HOOK" >&2
  exit 0
fi

export STRICT_TESTS="${STRICT_TESTS:-1}"
export SKIP_FORMAT="${SKIP_FORMAT:-0}"

cd "$ROOT_DIR"
"$HOOK"
