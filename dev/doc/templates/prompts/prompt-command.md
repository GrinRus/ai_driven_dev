---
description: {{DESCRIPTION}}
argument-hint: {{ARGUMENT_HINT}}
lang: {{LANG}}
prompt_version: {{PROMPT_VERSION}}
source_version: {{SOURCE_VERSION}}
allowed-tools: {{ALLOWED_TOOLS}}
model: inherit
---

## Контекст
Опишите назначение команды, связь с агентами и обязательные предварительные условия (активный ticket, готовые артефакты и т.д.). Уточните, что команда следует agent-first принципам: собирает данные из репозитория и запускает разрешённые CLI автоматически, а вопросы пользователю задаёт только при отсутствии информации.

## Входные артефакты
- Перечислите файлы/репорты (`aidd/docs/prd/*.md`, `aidd/docs/research/*.md`, `aidd/reports/*.json`, slug-hint в `aidd/docs/.active_feature`) и укажите, как команда находит их (например, `rg <ticket>`).
- Отметьте, что делать при отсутствии входа (остановиться с BLOCKED, попросить запустить другую команду) и какие команды нужно выполнить, прежде чем просить пользователя о данных.

## Когда запускать
- Опишите стадии workflow, в которых команда применяется, и кто инициирует запуск.
- Уточните ограничения (например, только после `/review-spec` или при статусе READY).

## Автоматические хуки и переменные
- Перечислите хуки/гейты и команды, запускаемые во время выполнения (`PYTHONPATH=${CLAUDE_PLUGIN_ROOT:-.} python3 -m aidd_runtime.cli set-active-feature`, `PYTHONPATH=${CLAUDE_PLUGIN_ROOT:-.} python3 -m aidd_runtime.cli research`, `${CLAUDE_PROJECT_DIR}/.claude/hooks/format-and-test.sh`, `<test-runner> <args>`, `rg`).
- Опишите переменные окружения (`SKIP_AUTO_TESTS`, `FORMAT_ONLY`, `TEST_SCOPE`) и требования к логам/ссылкам на вывод команд.

## Что редактируется
- Укажите файлы/директории, которые команда должна обновлять (например, `aidd/docs/tasklist/<ticket>.md`, `src/**`), и какие артефакты нужно ссылать в ответе (diff, отчёты, логи команд).
- Добавьте ссылки на шаблоны (`dev/doc/templates/prompts/prompt-agent.md`) и требования к структуре правок, включая хранение команд и источников данных.

## Пошаговый план
1. Распишите последовательность действий команды (вызов саб-агентов, запуск скриптов, обновление артефактов).
2. Добавьте проверки готовности (например, `PYTHONPATH=${CLAUDE_PLUGIN_ROOT:-.} python3 -m aidd_runtime.cli progress --source ...`).
3. При необходимости предусмотрите ветки для ручных вмешательств.

## Fail-fast и вопросы
- Опишите ситуации, когда команда должна остановиться (нет PRD, отсутствует approved статус, не найден список задач).
- Формат вопросов:
  ```
  Вопрос N (Blocker|Clarification): ...
  Зачем: ...
  Варианты: A) ... B) ...
  Default: ...
  ```

## Ожидаемый вывод
- Укажите, какие файлы/разделы должны быть обновлены по завершении.
- Зафиксируйте требования к финальному сообщению: `Checkbox updated: ...`, затем `Status: ...`, `Artifacts updated: ...`, `Next actions: ...`.

## Примеры CLI
- Приведите пример вызова команды/скрипта (например, `/implement ABC-123` или `!bash -lc 'PYTHONPATH=${CLAUDE_PLUGIN_ROOT:-.} python3 -m aidd_runtime.cli tasks-derive --source qa --ticket ABC-123'`).
- Добавьте подсказки по аргументам и типовым ошибкам.
