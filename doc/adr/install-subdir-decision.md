# ADR: Установка Claude workflow в поддиректорию `aidd/`

## Контекст
- Payload разросся: команды, агенты, хуки, пресеты, templates, docs.
- Требуется изоляция служебных файлов от кода продукта и reproducible-sync по manifest.
- Нужно поддерживать init/upgrade/sync из CLI и smoke с одинаковой структурой.

## Варианты
1) **Поверх корня**: раскладывать `.claude`, `docs`, `config` прямо в `<repo>/`.  
   - Плюсы: меньше вложенность, привычные пути.  
   - Минусы: коллизии с проектными файлами, сложнее обновлять payload, выше риск случайных удалений.
2) **Поддиректория `aidd/` (выбран)**: держать весь payload внутри `<workspace>/aidd/`.  
   - Плюсы: изоляция артефактов, простое обновление/удаление, можно иметь несколько инстансов.  
   - Минусы: дополнительный уровень пути, требуются обновления docs/хуков.
3) **Шаблонный репозиторий/подмодуль**: подключение payload как git-submodule.  
   - Плюсы: явное версионирование.  
   - Минусы: сложность для пользователей, лишняя git-зависимость, конфликт с CLI init.

## Решение
- Принять вариант 2: дефолтный таргет установки — поддиректория `aidd/` в рабочем каталоге.
- CLI (`init/sync/upgrade`) и smoke работают относительно `aidd/`, manifest содержит префикс `aidd/`.
- Dry-run не создаёт директорию; `resolve_project_root` учитывает существующий `.claude` и префикс.

## Последствия
- Документация и примеры должны ссылаться на пути `aidd/...`.
- Корневые служебные файлы (если остаются) считаются dev-only; payload распространяется только из `src/claude_workflow_cli/data/payload/aidd`.
- Хуки проверяют пути RU/EN промптов внутри `aidd/.claude` и `aidd/prompts/en`.

## To-do
- Обновить гайды (workflow.md, README*, prompt-playbook) с новой структурой путей.
- Описать миграцию для существующих установок (перенос из корня в `aidd/`).
