# Руководство по вкладу

Спасибо за интерес к проекту! Ниже описаны минимальные требования к изменениям и процессам, чтобы поддерживать Claude Code workflow стабильным и прозрачным.

## TL;DR
- Создавайте issue перед крупными доработками.
- Работайте из веток `feature/<ticket>` или `feat/<scope>` в зависимости от активной конвенции.
- Обновляйте документацию на двух языках: `README.md` (RU) и `README.en.md` (EN).
- Перед PR запустите `scripts/ci-lint.sh` (или `aidd/hooks/format-and-test.sh` в установленном workspace).

## Состав репозитория
- **Runtime (у пользователя):** `aidd/**` + корневые `.claude/` и `.claude-plugin/` после `claude-workflow init`.
- **Dev-only:** `doc/dev/`, `tests/`, `examples/`, `tools/`, `scripts/`, `.github/`, `.dev/`, `.tmp-debug/`, `build/`.

## Процесс работы
1. **Обсуждение.** Подготовьте issue или ссылку на ADR/PRD, если изменение затрагивает архитектуру.
2. **Ветка.** Создайте ветку командой `git checkout -b feature/<TICKET>` (или по другому паттерну из `config/conventions.json`).
3. **Коммиты.** Формируйте сообщения вручную (`git commit`), сверяясь с шаблонами в `config/conventions.json`. Для строгой проверки подключите git-хук из `docs/customization.md`.
4. **Тесты и форматирование.** Запустите `aidd/hooks/format-and-test.sh` (или `scripts/ci-lint.sh`, если работаете над CLI/payload). Для строгого режима выставьте `STRICT_TESTS=1`.
5. **Payload как единственный источник.** Правьте `.claude/`, `.claude-plugin/`, `aidd/**`, шаблоны и хуки только в `src/claude_workflow_cli/data/payload`. Перед правками выполните `scripts/sync-payload.sh --direction=to-root`, после правок — `scripts/sync-payload.sh --direction=from-root && python3 tools/check_payload_sync.py` (или `pre-commit run payload-sync-check`). Это гарантирует, что пакет `claude-workflow-cli` и runtime snapshot остаются в одном состоянии.
   Дополнительно запустите `python3 tools/payload_audit.py`, чтобы проверить состав дистрибутива по allowlist/denylist.
6. **Документация.** Обновите связанные файлы в `docs/`, `README.md` и `README.en.md`. Если меняется поведение скриптов, обновите `docs/customization.md` и `workflow.md`.
7. **Pull request.** Используйте шаблон PR, приложите ссылки на связанные задачи и укажите, как проверяли изменения локально.

## Код-стайл и тесты
- Поддерживайте существующие скрипты на Bash/Python без зависимостей, не входящих в стандартную библиотеку.
- Для новых функциональностей добавляйте smoke-тесты (`bats`, `pytest`) и описывайте их запуск.
- Не отключайте проверок форматирования или тестов без веской причины.

## Документация и переводы
- Каждый раздел с деталями должен иметь ссылку на расширенное описание в `docs/`.
- При изменении README:
  1. Правьте русскую версию (`README.md`).
  2. Сразу переносите изменения в `README.en.md`.
  3. Обновляйте поле _Last sync_ в английской версии.
- Добавляйте новые гайды в подпапку `docs/` и поддерживайте их в списке «Дополнительно» в обоих README.

## Безопасность и настройки
- Не ослабляйте ограничения `.claude/settings.json` без обсуждения: политика `ask/deny` защищает от случайных деструктивных команд.
- При необходимости расширить охраняемые каталоги обновляйте правила в `config/gates.json` или добавляйте кастомные гейты.
- Для новых пресетов конвенций создавайте отдельные JSON-файлы в `config/` и документируйте их в `docs/customization.md`.

## Выпуск релизов
- Собирайте изменения в релизные заметки (`docs/release-notes.md` — см. Wave 1 backlog).
- Обновляйте версию workflow в README и указывайте ключевые изменения.
- Добавляйте тег и публикуйте GitHub Release, если релиз предназначен для внешних пользователей.

Следуйте этим рекомендациям, и ваш вклад будет быстрее принят. Спасибо!
